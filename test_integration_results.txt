============================= test session starts =============================
platform win32 -- Python 3.12.7, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Klaus Pommer\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Klaus Pommer\OneDrive - Pommer IT-Consulting GmbH\99_Studium_Klaus\AEGIS_Rag
configfile: pytest.ini
plugins: anyio-4.11.0, langsmith-0.4.37, asyncio-0.23.8, cov-5.0.0, mock-3.15.1
asyncio: mode=Mode.AUTO
collecting ... collected 248 items

tests/integration/agents/test_memory_agent_e2e.py::test_memory_agent_process_with_coordinator_e2e SKIPPED__() got an unexpected keyword
argument 'neo4j_uri')                                                    [  0%]
tests/integration/agents/test_memory_agent_e2e.py::test_memory_agent_process_with_coordinator_e2e ERROR [  0%]
tests/integration/agents/test_memory_agent_e2e.py::test_memory_agent_retrieves_from_redis_e2e SKIPPED__() got an unexpected keyword
argument 'neo4j_uri')                                                    [  0%]
tests/integration/agents/test_memory_agent_e2e.py::test_memory_agent_state_management_e2e SKIPPED__() got an unexpected keyword argument
'neo4j_uri')                                                             [  1%]
tests/integration/agents/test_memory_agent_e2e.py::test_memory_agent_state_management_e2e ERROR [  1%]
tests/integration/agents/test_memory_agent_e2e.py::test_memory_node_function_e2e SKIPPED__() got an unexpected keyword argument 'neo4j_uri') [  1%]
tests/integration/agents/test_memory_agent_e2e.py::test_memory_agent_error_handling_e2e PASSED [  2%]
tests/integration/agents/test_memory_agent_e2e.py::test_memory_agent_latency_target_e2e SKIPPED__() got an unexpected keyword argument
'neo4j_uri')                                                             [  2%]
tests/integration/agents/test_memory_agent_e2e.py::test_memory_agent_latency_target_e2e ERROR [  2%]
tests/integration/api/test_memory_api_e2e.py::test_memory_search_endpoint_e2e PASSED [  2%]
tests/integration/api/test_memory_api_e2e.py::test_memory_search_validation_e2e PASSED [  3%]
tests/integration/api/test_memory_api_e2e.py::test_memory_search_with_layers_e2e PASSED [  3%]
tests/integration/api/test_memory_api_e2e.py::test_memory_search_time_window_e2e PASSED [  4%]
tests/integration/api/test_memory_api_e2e.py::test_point_in_time_endpoint_e2e PASSED [  4%]
tests/integration/api/test_memory_api_e2e.py::test_point_in_time_validation_e2e PASSED [  4%]
tests/integration/api/test_memory_api_e2e.py::test_session_context_endpoint_e2e PASSED [  5%]
tests/integration/api/test_memory_api_e2e.py::test_session_context_endpoint_e2e ERROR [  5%]
tests/integration/api/test_memory_api_e2e.py::test_session_context_not_found_e2e FAILED [  5%]

=================================== ERRORS ====================================
_____ ERROR at teardown of test_memory_agent_process_with_coordinator_e2e _____
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\pytest_asyncio\plugin.py:345: in finalizer
    event_loop.run_until_complete(async_finalizer())
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py:687: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\pytest_asyncio\plugin.py:337: in async_finalizer
    await gen_obj.__anext__()
tests\conftest.py:678: in redis_memory_manager
    await redis_client.flushdb()
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\client.py:646: in execute_command
    return await conn.retry.call_with_retry(
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\retry.py:59: in call_with_retry
    return await do()
           ^^^^^^^^^^
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\client.py:620: in _send_command_parse_response
    return await self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\client.py:667: in parse_response
    response = await connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\connection.py:562: in read_response
    response = await self._parser.read_response(
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\_parsers\resp2.py:82: in read_response
    response = await self._read_response(disable_decoding=disable_decoding)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\_parsers\resp2.py:90: in _read_response
    raw = await self._readline()
          ^^^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\_parsers\base.py:219: in _readline
    data = await self._stream.readline()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\streams.py:568: in readline
    line = await self.readuntil(sep)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\streams.py:660: in readuntil
    await self._wait_for_data('readuntil')
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\streams.py:545: in _wait_for_data
    await self._waiter
E   RuntimeError: Task <Task pending name='Task-6' coro=<_wrap_asyncgen_fixture.<locals>._asyncgen_fixture_wrapper.<locals>.finalizer.<locals>.async_finalizer() running at C:\Users\Klaus Pommer\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\pytest_asyncio\plugin.py:337> cb=[_run_until_complete_cb() at C:\Users\Klaus Pommer\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py:182]> got Future <Future pending> attached to a different loop
_________ ERROR at teardown of test_memory_agent_state_management_e2e _________
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\connection.py:493: in send_packed_command
    self._writer.writelines(command)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\streams.py:349: in writelines
    self._transport.writelines(data)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\transports.py:123: in writelines
    self.write(data)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\proactor_events.py:366: in write
    self._loop_writing(data=bytes(data))
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\proactor_events.py:402: in _loop_writing
    self._write_fut = self._loop._proactor.send(self._sock, data)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'NoneType' object has no attribute 'send'

During handling of the above exception, another exception occurred:
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\pytest_asyncio\plugin.py:345: in finalizer
    event_loop.run_until_complete(async_finalizer())
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py:687: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\pytest_asyncio\plugin.py:337: in async_finalizer
    await gen_obj.__anext__()
tests\conftest.py:678: in redis_memory_manager
    await redis_client.flushdb()
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\client.py:646: in execute_command
    return await conn.retry.call_with_retry(
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\retry.py:59: in call_with_retry
    return await do()
           ^^^^^^^^^^
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\client.py:619: in _send_command_parse_response
    await conn.send_command(*args)
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\connection.py:518: in send_command
    await self.send_packed_command(
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\connection.py:513: in send_packed_command
    await self.disconnect(nowait=True)
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\connection.py:438: in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\streams.py:358: in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\proactor_events.py:109: in close
    self._loop.call_soon(self._call_connection_lost, None)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py:795: in call_soon
    self._check_closed()
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py:541: in _check_closed
    raise RuntimeError('Event loop is closed')
E   RuntimeError: Event loop is closed
__________ ERROR at teardown of test_memory_agent_latency_target_e2e __________
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\connection.py:493: in send_packed_command
    self._writer.writelines(command)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\streams.py:349: in writelines
    self._transport.writelines(data)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\transports.py:123: in writelines
    self.write(data)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\proactor_events.py:366: in write
    self._loop_writing(data=bytes(data))
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\proactor_events.py:402: in _loop_writing
    self._write_fut = self._loop._proactor.send(self._sock, data)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'NoneType' object has no attribute 'send'

During handling of the above exception, another exception occurred:
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\pytest_asyncio\plugin.py:345: in finalizer
    event_loop.run_until_complete(async_finalizer())
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py:687: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\pytest_asyncio\plugin.py:337: in async_finalizer
    await gen_obj.__anext__()
tests\conftest.py:678: in redis_memory_manager
    await redis_client.flushdb()
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\client.py:646: in execute_command
    return await conn.retry.call_with_retry(
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\retry.py:59: in call_with_retry
    return await do()
           ^^^^^^^^^^
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\client.py:619: in _send_command_parse_response
    await conn.send_command(*args)
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\connection.py:518: in send_command
    await self.send_packed_command(
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\connection.py:513: in send_packed_command
    await self.disconnect(nowait=True)
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\connection.py:438: in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\streams.py:358: in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\proactor_events.py:109: in close
    self._loop.call_soon(self._call_connection_lost, None)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py:795: in call_soon
    self._check_closed()
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py:541: in _check_closed
    raise RuntimeError('Event loop is closed')
E   RuntimeError: Event loop is closed
___________ ERROR at teardown of test_session_context_endpoint_e2e ____________
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\connection.py:493: in send_packed_command
    self._writer.writelines(command)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\streams.py:349: in writelines
    self._transport.writelines(data)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\transports.py:123: in writelines
    self.write(data)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\proactor_events.py:366: in write
    self._loop_writing(data=bytes(data))
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\proactor_events.py:402: in _loop_writing
    self._write_fut = self._loop._proactor.send(self._sock, data)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'NoneType' object has no attribute 'send'

During handling of the above exception, another exception occurred:
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\pytest_asyncio\plugin.py:345: in finalizer
    event_loop.run_until_complete(async_finalizer())
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py:687: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\pytest_asyncio\plugin.py:337: in async_finalizer
    await gen_obj.__anext__()
tests\conftest.py:678: in redis_memory_manager
    await redis_client.flushdb()
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\client.py:646: in execute_command
    return await conn.retry.call_with_retry(
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\retry.py:59: in call_with_retry
    return await do()
           ^^^^^^^^^^
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\client.py:619: in _send_command_parse_response
    await conn.send_command(*args)
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\connection.py:518: in send_command
    await self.send_packed_command(
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\connection.py:513: in send_packed_command
    await self.disconnect(nowait=True)
..\..\..\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\redis\asyncio\connection.py:438: in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\streams.py:358: in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\proactor_events.py:109: in close
    self._loop.call_soon(self._call_connection_lost, None)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py:795: in call_soon
    self._check_closed()
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py:541: in _check_closed
    raise RuntimeError('Event loop is closed')
E   RuntimeError: Event loop is closed
================================== FAILURES ===================================
_____________________ test_session_context_not_found_e2e ______________________
tests\integration\api\test_memory_api_e2e.py:68: in test_session_context_not_found_e2e
    assert response.status_code == 404
E   assert 500 == 404
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
============================== warnings summary ===============================
tests/integration/api/test_memory_api_e2e.py::test_session_context_not_found_e2e
  C:\Users\Klaus Pommer\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\structlog\_base.py:165: UserWarning: Remove `format_exc_info` from your processor chain if you want pretty exceptions.
    event_dict = proc(self._logger, method_name, event_dict)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
SKIPPED [1] tests\integration\agents\test_memory_agent_e2e.py:18: Graphiti not available: Failed to initialize Graphiti: Graphiti.__init__() got an unexpected keyword argument 'neo4j_uri'
SKIPPED [1] tests\integration\agents\test_memory_agent_e2e.py:27: Graphiti not available: Failed to initialize Graphiti: Graphiti.__init__() got an unexpected keyword argument 'neo4j_uri'
SKIPPED [1] tests\integration\agents\test_memory_agent_e2e.py:35: Graphiti not available: Failed to initialize Graphiti: Graphiti.__init__() got an unexpected keyword argument 'neo4j_uri'
SKIPPED [1] tests\integration\agents\test_memory_agent_e2e.py:42: Graphiti not available: Failed to initialize Graphiti: Graphiti.__init__() got an unexpected keyword argument 'neo4j_uri'
SKIPPED [1] tests\integration\agents\test_memory_agent_e2e.py:53: Graphiti not available: Failed to initialize Graphiti: Graphiti.__init__() got an unexpected keyword argument 'neo4j_uri'
ERROR tests/integration/agents/test_memory_agent_e2e.py::test_memory_agent_process_with_coordinator_e2e - RuntimeError: Task <Task pending name='Task-6' coro=<_wrap_asyncgen_fixture.<locals>._asyncgen_fixture_wrapper.<locals>.finalizer.<locals>.async_finalizer() running at C:\Users\Klaus Pommer\AppData\Local\pypoetry\Cache\virtualenvs\aegis-rag--u84tAYU-py3.12\Lib\site-packages\pytest_asyncio\plugin.py:337> cb=[_run_until_complete_cb() at C:\Users\Klaus Pommer\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py:182]> got Future <Future pending> attached to a different loop
ERROR tests/integration/agents/test_memory_agent_e2e.py::test_memory_agent_state_management_e2e - RuntimeError: Event loop is closed
ERROR tests/integration/agents/test_memory_agent_e2e.py::test_memory_agent_latency_target_e2e - RuntimeError: Event loop is closed
ERROR tests/integration/api/test_memory_api_e2e.py::test_session_context_endpoint_e2e - RuntimeError: Event loop is closed
FAILED tests/integration/api/test_memory_api_e2e.py::test_session_context_not_found_e2e - assert 500 == 404
 +  where 500 = <Response [500 Internal Server Error]>.status_code
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 5 failures !!!!!!!!!!!!!!!!!!!!!!!!!!
======== 1 failed, 8 passed, 5 skipped, 1 warning, 4 errors in 38.18s =========
